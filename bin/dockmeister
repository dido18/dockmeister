#!/usr/bin/env ruby
$:.unshift(File.dirname('../lib'))

require 'dockmeister'

DOCKER_COMPOSE_CMD = 'docker-compose --file ./docker-compose.yml'
COMMANDS = ['compose', 'build', 'up']

command = ARGV.first

if COMMANDS.include?(command)
  Dockmeister.public_send(command)
else
  puts <<-eos
    USAGE
      dockmeister [COMMAND]

    COMMANDS:

    #### compose

    Prepares a composition of each services' `docker-compose.yml` file into a single `docker-compose.yml` file. All `build` and `volume` paths are adjusted to be relative to the root directory.

    #### build

    For each service:

    - Runs the pre-build scripts
    - Builds the docker containers using `docker-compose build`.
    - Runs the post-build scripts

    Pre- and post-build scripts reside in the `scripts/` sub-directory.
    The filenames of the scripts are required to have a `pre` or `post` prefix.
    The scripts will be run from the service folder.

    #### up

    Starts the containers using `docker-compose up`
    eos
end
