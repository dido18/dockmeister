#!/usr/bin/env ruby
$:.unshift(File.dirname('../lib'))

require 'lib/dockyard'
require 'yaml'

command = ARGV.first

case command
when "compose"
  config = YAML.load_file('dockyard.yml')

  services = config['services'].inject({}) do |memo, service|
    memo[service] = YAML.load_file("./#{service}/docker-compose.yml")

    memo
  end

  composed = Dockyard::Composer.compose(services)

  File.open('docker-compose.yml', 'w') { |f| f.write(composed.to_yaml) }
end
